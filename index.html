<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Brat Meme Maker</title>
<style>
  body {
    text-align: center;
    font-family: 'Poppins', sans-serif;
    background-color: #fce4ec;
    margin: 0;
    padding: 20px;
    transition: background-color 0.3s;
  }

  h1 {
    color: #d81b60;
    margin-bottom: 10px;
  }

  #canvas {
    width: 300px;
    height: 300px;
    border: 3px solid #000;
    margin: 20px auto;
    background-color: #fff;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 26px;
    font-weight: bold;
    text-transform: uppercase;
    color: #000;
    border-radius: 10px;
  }

  .controls {
    margin-top: 20px;
  }

  select, button, input {
    font-size: 16px;
    padding: 8px;
    margin: 5px;
    border-radius: 8px;
    border: 2px solid #d81b60;
  }

  button {
    cursor: pointer;
    background-color: #d81b60;
    color: white;
  }

  button:disabled {
    background-color: #aaa;
    cursor: not-allowed;
  }

  .color-option {
    margin: 0 5px;
    width: 25px;
    height: 25px;
    border-radius: 50%;
    border: 2px solid #000;
    display: inline-block;
    cursor: pointer;
  }

  .locked {
    background-color: gray !important;
  }

  #passwordBox {
    display: none;
    margin-top: 10px;
  }

  /* üî• Popup Styles */
  #popup {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%) scale(0.9);
    background: white;
    color: black;
    padding: 20px 30px;
    border-radius: 15px;
    box-shadow: 0 0 20px rgba(0,0,0,0.3);
    display: none;
    z-index: 999;
    text-align: center;
    font-size: 18px;
    animation: popIn 0.3s ease forwards;
  }

  #popup.success { border: 3px solid #4caf50; }
  #popup.error { border: 3px solid #f44336; }

  @keyframes popIn {
    from { transform: translate(-50%, -50%) scale(0.7); opacity: 0; }
    to { transform: translate(-50%, -50%) scale(1); opacity: 1; }
  }
</style>
</head>
<body>

<h1>üå∏ Brat Meme Maker üå∏</h1>
<div id="canvas">BRAT üòé</div>

<div class="controls">
  <label>Background:</label><br>
  <span class="color-option" style="background-color:pink;" onclick="setColor('pink')"></span>
  <span class="color-option" style="background-color:lightblue;" onclick="setColor('lightblue')"></span>
  <span class="color-option" style="background-color:lightgreen;" onclick="setColor('lightgreen')"></span>
  <span class="color-option" style="background-color:lavender;" onclick="setColor('lavender')"></span>
  <span class="color-option" style="background-color:gold;" onclick="setColor('gold')"></span>
  <span class="color-option" style="background-color:#004d00;" onclick="setColor('#004d00')"></span> <!-- NEW DARK GREEN -->
</div>

<div class="controls">
  <input type="text" id="memeText" placeholder="Enter meme text">
  <button onclick="setText()">Set Text</button>
</div>

<div class="controls">
  <button id="downloadBtn" onclick="handleDownload()">Download Meme (PNG)</button>
</div>

<div id="passwordBox">
  <input type="password" id="unlockPassword" placeholder="Enter password">
  <button onclick="unlock()">Unlock</button>
</div>

<div id="popup"></div>

<script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
<script>
  const canvas = document.getElementById('canvas');
  const downloadBtn = document.getElementById('downloadBtn');
  const passwordBox = document.getElementById('passwordBox');
  const popup = document.getElementById('popup');
  let downloadCount = parseInt(localStorage.getItem('brat_downloads') || '0');
  const maxDownloads = 3;
  const unlockPass = "bratxpro";

  function setColor(color) {
    canvas.style.backgroundColor = color;
  }

  function setText() {
    const text = document.getElementById('memeText').value || "BRAT üòé";
    canvas.textContent = text.toUpperCase();
  }

  function showPopup(message, type = "success") {
    popup.textContent = message;
    popup.className = type;
    popup.style.display = "block";
    popup.style.animation = "popIn 0.3s ease forwards";
    setTimeout(() => {
      popup.style.display = "none";
    }, 2000);
  }

  function checkDailyLimit() {
    if (downloadCount >= maxDownloads) {
      downloadBtn.disabled = true;
      downloadBtn.textContent = "üîí Locked (Password Required)";
      passwordBox.style.display = "block";
      return false;
    }
    return true;
  }

  function incrementCount() {
    downloadCount++;
    localStorage.setItem('brat_downloads', downloadCount);
  }

  function unlock() {
    const entered = document.getElementById('unlockPassword').value;
    if (entered === unlockPass) {
      downloadCount = 0;
      localStorage.setItem('brat_downloads', '0');
      passwordBox.style.display = "none";
      downloadBtn.disabled = false;
      downloadBtn.textContent = "Download Meme (PNG)";
      showPopup("‚úÖ Unlocked successfully!", "success");
    } else {
      showPopup("‚ùå Incorrect password!", "error");
    }
  }

  async function handleDownload() {
    if (!checkDailyLimit()) return;

    const originalBg = document.body.style.backgroundColor;
    document.body.style.backgroundColor = canvas.style.backgroundColor;

    try {
      const canvasImage = await html2canvas(canvas, {
        allowTaint: true,
        useCORS: true,
        scale: 2
      });

      canvasImage.toBlob(async function(blob) {
        const file = new File([blob], 'brat_meme_' + Date.now() + '.png', { type: 'image/png' });

        if (navigator.canShare && navigator.canShare({ files: [file] })) {
          await navigator.share({
            files: [file],
            title: 'Brat Meme',
            text: 'Here‚Äôs your meme üòé'
          });
          showPopup("üéâ Meme shared/saved successfully!", "success");
        } else {
          const link = document.createElement('a');
          link.download = file.name;
          link.href = URL.createObjectURL(blob);
          link.click();
          URL.revokeObjectURL(link.href);
          showPopup("üì∏ Meme downloaded!", "success");
        }

        incrementCount();
        checkDailyLimit();
      }, 'image/png');
    } catch (err) {
      console.error("Error generating image:", err);
      showPopup("‚ùå Oops! Something went wrong.", "error");
    } finally {
      document.body.style.backgroundColor = originalBg;
    }
  }

  checkDailyLimit();
</script>

</body>
</html>
