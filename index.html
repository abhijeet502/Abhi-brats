<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Brat Meme Generator</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://html2canvas.hertzen.com/dist/html2canvas.hertzen.min.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Permanent+Marker&display=swap" rel="stylesheet">
  <style>
    .font-brat { font-family: 'Arial Black', Impact, sans-serif; font-weight:900; }
    .font-monospace { font-family: 'Courier New', Courier, monospace; }
    .font-handwritten { font-family: 'Permanent Marker', cursive; font-weight:400; }
    .brat-text { line-height:1.0; word-break:break-word; white-space:pre-wrap; transition:color .1s; }
    .text-outline-white { -webkit-text-stroke:3px white; text-stroke:3px white; }
    .text-outline-black { -webkit-text-stroke:3px black; text-stroke:3px black; }
    .text-glow-pink { text-shadow:0 0 3px rgba(255,0,100,.6), 0 0 6px rgba(255,0,150,.4); }
    ::-webkit-scrollbar { width:8px; } ::-webkit-scrollbar-track { background:#f1f1f1; } ::-webkit-scrollbar-thumb { background:#a3a3a3; border-radius:4px; }
    .range-pink-500::-webkit-slider-thumb { background-color:#ec4899; } .range-pink-500::-moz-range-thumb { background-color:#ec4899; }
    /* Presentation mode styles */
    .presentation-body { display:flex; align-items:center; justify-content:center; height:100vh; margin:0; background:#fff; }
    .presentation-canvas { box-shadow: none; border-radius:0 !important; width:100vw; height:100vh; display:flex; align-items:center; justify-content:center; }
    /* Small top bar when in presentation */
    .presentation-topbar { position:fixed; top:8px; left:50%; transform:translateX(-50%); z-index:60; background:rgba(255,255,255,.95); padding:.35rem .6rem; border-radius:999px; box-shadow:0 3px 8px rgba(0,0,0,.12); font-weight:600; }
  </style>
</head>
<body class="min-h-screen p-4 flex flex-col items-center font-inter" style="background-color:#fae6f0;">
  <div id="app" class="max-w-xl w-full">
    <header id="top-header" class="text-center mb-6">
      <h1 class="text-4xl font-extrabold text-black tracking-tight leading-tight">Brat Text Generator</h1>
      <p class="text-sm text-pink-800 mt-1 italic text-glow-pink font-semibold">by Abhiiii...ü´¥üèª for the meme geeks</p>
    </header>

    <!-- Canvas -->
    <div id="meme-wrap" class="w-full mb-6">
      <div id="meme-canvas" class="w-full aspect-square flex items-center justify-center p-4 shadow-xl transition-colors duration-300"
           style="background-color:#fce7f3; min-height:350px; border-radius:12px;">
        <div id="brat-output" class="brat-text font-brat text-center text-5xl sm:text-7xl lg:text-8xl w-full leading-none break-words" style="color:#000;">
          Brat and it's the same but there's three more songs so it's not
        </div>
      </div>
    </div>

    <!-- Controls panel -->
    <div id="controls" class="bg-white p-4 rounded-xl shadow-lg space-y-4">
      <div>
        <label for="text-input" class="block text-sm font-medium text-gray-700 mb-1">Your Text (Use Enter for New Lines):</label>
        <textarea id="text-input" rows="4" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-pink-500 focus:border-pink-500 text-base"
                  placeholder="Type your meme text here..."></textarea>
      </div>

      <div class="grid grid-cols-2 gap-3 pt-2">
        <button id="style-green-btn" class="w-full py-2 px-4 bg-lime-500 text-black font-semibold rounded-lg shadow-md text-sm opacity-50 cursor-not-allowed" disabled>Green Scratched Style (Removed)</button>
        <button id="style-blue-red-btn" class="w-full py-2 px-4 bg-blue-600 text-red-400 font-semibold rounded-lg shadow-md hover:bg-blue-700 text-sm">Blue/Red Style</button>
      </div>

      <div class="grid grid-cols-3 gap-3">
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">Text Style:</label>
          <select id="text-style" class="w-full p-2 border border-gray-300 rounded-lg text-sm">
            <option value="font-brat">Brat Style (Impact)</option>
            <option value="font-monospace">Monospace</option>
            <option value="font-handwritten">Handwritten</option>
          </select>
        </div>

        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">Text Color:</label>
          <button id="text-color-btn" class="w-full p-2 bg-black text-white rounded-lg font-semibold text-sm border-2 border-black">Black Text</button>
        </div>

        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">Case:</label>
          <button id="case-toggle-btn" class="w-full p-2 bg-purple-500 text-white rounded-lg font-semibold text-sm">UPPERCASE</button>
        </div>
      </div>

      <div>
        <label class="block text-sm font-medium text-gray-700 mb-1">Text Outline (Stroke):</label>
        <button id="outline-toggle-btn" class="w-full p-2 bg-gray-200 text-gray-800 rounded-lg font-semibold text-sm border-2 border-gray-400">No Outline</button>
      </div>

      <div>
        <label class="block text-sm font-medium text-gray-700 mb-2">Background Color:</label>
        <div id="color-selector" class="flex flex-wrap gap-2 p-2 border border-gray-300 rounded-lg justify-center sm:justify-start"></div>
      </div>

      <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
        <div>
          <label class="block text-sm font-medium text-transparent mb-1 select-none">Action</label>
          <button id="randomize-btn" class="w-full py-2 px-4 bg-orange-500 text-white rounded-lg font-semibold text-sm">Randomize Placement</button>
        </div>

        <div>
          <label for="font-size" class="block text-sm font-medium text-gray-700 mb-1">Font Size (Max 62px)</label>
          <input type="range" id="font-size" min="30" max="62" value="62" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer range-pink-500">
          <span id="font-size-value" class="text-xs text-gray-500 block text-center mt-1">62px</span>
        </div>

        <div>
          <label for="border-radius" class="block text-sm font-medium text-gray-700 mb-1">Border Radius</label>
          <input type="range" id="border-radius" min="0" max="50" value="12" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer range-pink-500">
          <span id="border-radius-value" class="text-xs text-gray-500 block text-center mt-1">12px</span>
        </div>
      </div>

      <!-- NEW: Generate button (replaces the old download flow) -->
      <button id="generate-btn" class="w-full py-3 px-4 bg-pink-500 text-white text-lg font-bold rounded-lg shadow-xl hover:bg-pink-600 transition duration-150">
        Generate (PNG)
      </button>

      <!-- Limit & unlock panel (hidden by default) -->
      <div id="limit-panel" class="hidden text-center p-3 bg-red-100 border border-red-400 rounded-lg space-y-3">
        <p class="font-bold text-red-700">Oops ‚Äî you have hit the limit for today. Ask Abhi for the password to generate without hassle.</p>
        <div class="flex space-x-2">
          <input id="limit-password" type="password" placeholder="Enter secret code" class="flex-grow p-2 border border-gray-300 rounded-lg">
          <button id="limit-unlock-btn" class="bg-red-500 text-white px-3 py-2 rounded-lg">Unlock</button>
        </div>
        <p id="limit-error" class="text-sm text-red-500 hidden">Incorrect code. Try again.</p>
      </div>
    </div>

    <p id="hint" class="text-center text-xs text-gray-500 mt-4">*After you click Generate the interface will hide so you can take a clean screenshot. You get 2 free generations per day.</p>
  </div>

  <footer id="page-footer" class="mt-6 pb-6 text-center text-sm text-gray-600">
    ¬© 2025 Crafted with <span class="text-red-500">üíñ</span> by Abhi for the Meme Geeks
  </footer>

  <script>
    // Elements
    const canvasWrap = document.getElementById('meme-wrap');
    const canvasEl = document.getElementById('meme-canvas');
    const outputDiv = document.getElementById('brat-output');
    const textInput = document.getElementById('text-input');
    const colorSelector = document.getElementById('color-selector');
    const generateBtn = document.getElementById('generate-btn');
    const controls = document.getElementById('controls');
    const topHeader = document.getElementById('top-header');
    const pageFooter = document.getElementById('page-footer');
    const hintP = document.getElementById('hint');
    const limitPanel = document.getElementById('limit-panel');
    const limitPassword = document.getElementById('limit-password');
    const limitUnlockBtn = document.getElementById('limit-unlock-btn');
    const limitError = document.getElementById('limit-error');

    const textStyleSelect = document.getElementById('text-style');
    const textColorBtn = document.getElementById('text-color-btn');
    const caseToggleBtn = document.getElementById('case-toggle-btn');
    const outlineToggleBtn = document.getElementById('outline-toggle-btn');
    const randomizeBtn = document.getElementById('randomize-btn');
    const fontSizeInput = document.getElementById('font-size');
    const fontSizeValue = document.getElementById('font-size-value');
    const borderRadiusInput = document.getElementById('border-radius');
    const borderRadiusValue = document.getElementById('border-radius-value');
    const styleBlueRedBtn = document.getElementById('style-blue-red-btn');

    // Config
    const DAILY_LIMIT = 2;
    const SECRET_CODE = 'ABHIJEET0123';
    const COUNT_KEY = 'bratGenerator_dailyCount';
    const DATE_KEY = 'bratGenerator_lastDate';
    const UNLIMITED_KEY = 'bratGenerator_unlimitedAccess';

    // State
    let currentFontSize = 62;
    let currentFontStyle = 'font-brat';
    let isUppercase = false;
    let isWhiteText = false;
    let currentBackgroundColor = '#fce7f3';
    let currentTextColor = '#000000';
    let activeSpecialStyle = null;
    let currentActiveColorButton = null;
    let currentOutlineState = 0;
    const outlineClasses = ['', 'text-outline-white', 'text-outline-black'];
    const outlineLabels = ['No Outline', 'White Outline', 'Black Outline'];

    // Colors (added dark green)
    const colors = [
      { name: 'Light Pink (UI)', value:'#fae6f0', border:'border-pink-500' },
      { name: 'Pink', value:'#fce7f3', border:'border-pink-500' },
      { name: 'Black', value:'#000000', border:'border-white' },
      { name: 'White', value:'#ffffff', border:'border-gray-500' },
      { name: 'Yellow', value:'#fde047', border:'border-yellow-600' },
      { name: 'Red', value:'#fca5a5', border:'border-red-600' },
      { name: 'Orange', value:'#fed7aa', border:'border-orange-600' },
      { name: 'Green', value:'#d9f99d', border:'border-green-600' },
      { name: 'Dark Green', value:'#065f46', border:'border-green-800' }
    ];

    // Utility: messages
    function showMessage(text) {
      const id = 'temp-msg';
      let el = document.getElementById(id);
      if (!el) {
        el = document.createElement('div');
        el.id = id;
        el.className = 'fixed top-4 right-4 bg-pink-600 text-white p-3 rounded-lg shadow-xl z-50';
        document.body.appendChild(el);
      }
      el.textContent = text;
      setTimeout(() => { if(el) el.remove(); }, 3000);
    }

    // Daily limit helpers
    function checkDailyLimit() {
      if (localStorage.getItem(UNLIMITED_KEY) === 'true') return { allowed:true, count:'Unlimited' };
      const today = new Date().toDateString();
      const last = localStorage.getItem(DATE_KEY);
      let count = parseInt(localStorage.getItem(COUNT_KEY) || '0', 10);
      if (last !== today) {
        count = 0;
        localStorage.setItem(COUNT_KEY, '0');
        localStorage.setItem(DATE_KEY, today);
      }
      return { allowed: count < DAILY_LIMIT, count };
    }
    function incrementCount() {
      if (localStorage.getItem(UNLIMITED_KEY) === 'true') return;
      let count = parseInt(localStorage.getItem(COUNT_KEY) || '0', 10);
      count += 1;
      localStorage.setItem(COUNT_KEY, count.toString());
      // update button label/hint
      updateUsageHint();
    }

    function updateUsageHint() {
      const status = checkDailyLimit();
      if (status.count === 'Unlimited') {
        hintP.textContent = '*You have unlimited access (unlocked).';
      } else {
        hintP.textContent = `*After you click Generate the interface will hide so you can take a clean screenshot. You have used ${status.count}/${DAILY_LIMIT} today.`;
      }
    }

    // Create color buttons
    function createColorButtons() {
      colorSelector.innerHTML = '';
      colors.forEach((c, i) => {
        const btn = document.createElement('button');
        btn.className = `w-8 h-8 rounded-full shadow-md transition transform hover:scale-110 ${c.border} border-2`;
        btn.style.backgroundColor = c.value;
        btn.title = c.name;
        btn.onclick = () => {
          activeSpecialStyle = null;
          deactivateStyleButtons();
          applyColor(c.value);
          applyTextColor(isWhiteText ? '#ffffff' : '#000000');
          document.querySelectorAll('#color-selector button').forEach(b=>b.style.borderWidth='2px');
          btn.style.borderWidth='4px';
          currentActiveColorButton = btn;
        };
        colorSelector.appendChild(btn);
        if (i===1) { btn.style.borderWidth='4px'; currentActiveColorButton = btn; }
      });
    }

    function applyColor(val) { currentBackgroundColor = val; canvasEl.style.backgroundColor = val; }
    function applyTextColor(val) { currentTextColor = val; outputDiv.style.color = val; }

    function applyFontStyle(styleClass) {
      outputDiv.classList.remove(currentFontStyle);
      outputDiv.classList.add(styleClass);
      currentFontStyle = styleClass;
      applyFontSize(currentFontSize);
    }

    function applyFontSize(size) {
      currentFontSize = Math.min(size, 62);
      fontSizeInput.value = currentFontSize;
      outputDiv.style.fontSize = `${currentFontSize}px`;
      fontSizeValue.textContent = `${currentFontSize}px`;
      outputDiv.style.lineHeight = (currentFontStyle === 'font-handwritten') ? '1.1' : '1.0';
    }

    function applyBorderRadius(radius) {
      canvasEl.style.borderRadius = `${radius}px`;
      borderRadiusValue.textContent = `${radius}px`;
    }

    function toggleTextColor() {
      activeSpecialStyle = null;
      deactivateStyleButtons();
      isWhiteText = !isWhiteText;
      const color = isWhiteText ? '#ffffff' : '#000000';
      const label = isWhiteText ? 'White Text' : 'Black Text';
      applyTextColor(color);
      textColorBtn.textContent = label;
      textColorBtn.classList.toggle('bg-black', !isWhiteText);
      textColorBtn.classList.toggle('text-white', !isWhiteText);
      textColorBtn.classList.toggle('bg-white', isWhiteText);
      textColorBtn.classList.toggle('text-black', isWhiteText);
    }

    function toggleOutline() {
      currentOutlineState = (currentOutlineState + 1) % outlineClasses.length;
      outputDiv.classList.remove(...outlineClasses.filter(c=>c!==''));
      const cls = outlineClasses[currentOutlineState];
      if (cls) outputDiv.classList.add(cls);
      outlineToggleBtn.textContent = outlineLabels[currentOutlineState];
    }

    function toggleCase() {
      isUppercase = !isUppercase;
      if (isUppercase) { outputDiv.classList.add('uppercase'); caseToggleBtn.textContent='Normal Case'; }
      else { outputDiv.classList.remove('uppercase'); caseToggleBtn.textContent='UPPERCASE'; }
    }

    function deactivateStyleButtons() {
      styleBlueRedBtn.classList.remove('ring-4','ring-offset-2','ring-red-700');
      if (currentActiveColorButton) { currentActiveColorButton.style.borderWidth='2px'; currentActiveColorButton = null; }
    }

    function setSpecialStyle(name, btnEl) {
      if (name!=='blue-red') return;
      document.querySelectorAll('#color-selector button').forEach(b=>b.style.borderWidth='2px');
      if (activeSpecialStyle === name) {
        activeSpecialStyle = null; deactivateStyleButtons(); applyColor(colors[1].value); applyTextColor(colors[2].value);
        const defaultBtn = colorSelector.querySelector(`button[title="${colors[1].name}"]`);
        if (defaultBtn) { defaultBtn.style.borderWidth='4px'; currentActiveColorButton = defaultBtn; }
      } else {
        activeSpecialStyle = name; deactivateStyleButtons(); btnEl.classList.add('ring-4','ring-offset-2','ring-red-700');
        applyColor('#1d4ed8'); applyTextColor('#ef4444');
      }
      updateText();
    }

    function updateText() {
      let t = textInput.value.trim();
      if (!t) t = "Brat and it's the same but there's three more songs so it's not";
      outputDiv.textContent = t;
      resetPlacement();
      applyActiveStyle();
    }

    function applyActiveStyle() {
      if (activeSpecialStyle === 'blue-red') { applyColor('#1d4ed8'); applyTextColor('#ef4444'); }
      else { applyColor(currentBackgroundColor); applyTextColor(currentTextColor); }
    }

    function randomizePlacement() {
      resetPlacement();
      const lines = outputDiv.textContent.split('\n');
      outputDiv.innerHTML = '';
      lines.forEach(line => {
        const span = document.createElement('span');
        span.textContent = line.trim();
        const ml = Math.floor(Math.random()*21)-10;
        const mr = Math.floor(Math.random()*21)-10;
        const pt = Math.floor(Math.random()*11);
        const pb = Math.floor(Math.random()*11);
        span.style.display='block';
        span.style.marginLeft=`${ml}px`;
        span.style.marginRight=`${mr}px`;
        span.style.paddingTop=`${pt}px`;
        span.style.paddingBottom=`${pb}px`;
        span.className = outputDiv.className;
        span.style.cssText += outputDiv.style.cssText;
        span.style.color = currentTextColor;
        outputDiv.appendChild(span);
      });
      randomizeBtn.textContent='Reset Placement';
      randomizeBtn.classList.replace('bg-orange-500','bg-gray-500');
    }

    function resetPlacement() {
      let t = textInput.value.trim();
      if (!t) t = "Brat and it's the same but there's three more songs so it's not";
      outputDiv.textContent = t;
      randomizeBtn.textContent='Randomize Placement';
      randomizeBtn.classList.replace('bg-gray-500','bg-orange-500');
      applyFontStyle(currentFontStyle);
      applyFontSize(currentFontSize);
      if (isUppercase) outputDiv.classList.add('uppercase');
      applyActiveStyle();
    }

    // NEW: presentation mode toggles - hides UI so user can screenshot.
    function enterPresentationMode() {
      // hide UI sections but keep canvas visible and expand it
      controls.classList.add('hidden');
      topHeader.classList.add('hidden');
      pageFooter.classList.add('hidden');
      hintP.classList.add('hidden');

      document.documentElement.classList.add('presentation-body');
      canvasEl.classList.add('presentation-canvas');

      // small topbar with Exit + usage
      const bar = document.createElement('div');
      bar.id = 'presentation-bar';
      bar.className = 'presentation-topbar';
      bar.innerHTML = `<span id="usage-label">Use: ${checkDailyLimit().count}/${DAILY_LIMIT}</span>
                       <button id="exit-presentation" class="ml-3 px-2 py-1 text-sm rounded bg-gray-200">Exit</button>`;
      document.body.appendChild(bar);
      document.getElementById('exit-presentation').addEventListener('click', exitPresentationMode);
    }

    function exitPresentationMode() {
      controls.classList.remove('hidden');
      topHeader.classList.remove('hidden');
      pageFooter.classList.remove('hidden');
      hintP.classList.remove('hidden');
      document.documentElement.classList.remove('presentation-body');
      canvasEl.classList.remove('presentation-canvas');
      const bar = document.getElementById('presentation-bar');
      if (bar) bar.remove();
    }

    // Limit/unlock handling
    function showLimitPanel() {
      limitPanel.classList.remove('hidden');
      window.scrollTo({ top: limitPanel.getBoundingClientRect().top + window.scrollY - 60, behavior: 'smooth' });
    }
    function hideLimitPanel() { limitPanel.classList.add('hidden'); limitError.classList.add('hidden'); limitPassword.value=''; }

    function handleUnlockAttempt() {
      const code = (limitPassword.value||'').trim();
      if (code === SECRET_CODE) {
        localStorage.setItem(UNLIMITED_KEY, 'true');
        limitError.classList.add('hidden');
        showMessage('Unlocked! You now have unlimited generations.');
        hideLimitPanel();
        updateUsageHint();
      } else {
        limitError.classList.remove('hidden');
        limitPassword.value='';
      }
    }

    // Generate button logic: uses same daily limit behavior as downloads did.
    generateBtn.addEventListener('click', () => {
      const status = checkDailyLimit();
      if (!status.allowed) {
        showLimitPanel();
        return;
      }

      // Allowed: increment count and enter presentation so user can screenshot
      incrementCount();
      updateUsageHint();

      // Enter presentation mode so user can take screenshot of the canvas
      enterPresentationMode();

      // Optional: briefly flash a message
      showMessage('Presentation mode: take a screenshot now. Tap Exit when done.');
    });

    limitUnlockBtn.addEventListener('click', handleUnlockAttempt);
    limitPassword.addEventListener('keypress', (e) => { if (e.key === 'Enter') handleUnlockAttempt(); });

    // Wire UI controls
    textInput.addEventListener('input', updateText);
    textStyleSelect.addEventListener('change', (e) => applyFontStyle(e.target.value));
    textColorBtn.addEventListener('click', toggleTextColor);
    outlineToggleBtn.addEventListener('click', toggleOutline);
    caseToggleBtn.addEventListener('click', toggleCase);
    randomizeBtn.addEventListener('click', () => {
      if (randomizeBtn.textContent === 'Randomize Placement') randomizePlacement();
      else resetPlacement();
    });
    fontSizeInput.addEventListener('input', (e) => applyFontSize(parseInt(e.target.value)));
    borderRadiusInput.addEventListener('input', (e) => applyBorderRadius(parseInt(e.target.value)));
    styleBlueRedBtn.addEventListener('click', () => setSpecialStyle('blue-red', styleBlueRedBtn));

    // Initialization
    document.addEventListener('DOMContentLoaded', () => {
      createColorButtons();
      currentFontSize = 62;
      fontSizeInput.value = 62;
      updateText();
      applyFontSize(currentFontSize);
      applyBorderRadius(parseInt(borderRadiusInput.value || 12));
      updateUsageHint();
    });
  </script>
</body>
</html>
